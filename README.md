pySHRA is an open-source package for simulating Second Harmonic Rotational Anisotropy (SHRA). SHRA is an optical technique which involves measuring the second harmonic response of a sample as a function of azimuthal rotation $\phi$. In typical experiments, a pre-sample polarizer and post-sample analyzer are used to control the polarization direction of the incident fundamental and the measured output second harmonic. Canonical input-output polarization combinations include: p-in/p-out, p-in/s-out, s-in/p-out, s-in/s-out. pySHRA supports modeling of samples whose linear optical properties are isotropic (scalar $\epsilon$) or uniaxial ($\epsilon_{o}$, $\epsilon_{e}$) in nature. The (lossless) incident medium is assumed to have isotropic linear optical properties (e.g., air, water). pySHRA uses a Green function-based approach to calculate reflected SH electric field amplitudes originating from two possible optical nonlinearities at the sample interface: (1) a 2nd-order surface susceptibility tensor $\boldsymbol{\chi}^{(2)}(-2\omega;\omega,\omega)$, and (2) a 3rd-order susceptibility tensor $\boldsymbol{\chi}^{(3)}(-2\omega;\omega,\omega,0)$ belonging to the incident medium. pySHRA was designed to facilitate analysis of second harmonic generation from electrode-electrolyte interfaces formed from two centrosymmetric media. At present, pySHRA does not consider other nonlinearities such as electric quadrupole or magnetic dipole effects, or $\boldsymbol{\chi}^{(3)}(-2\omega;\omega,\omega,0)$ of the sample. 

The input parameters of pySHRA are: (1) the frequency of the fundamental $\omega$, (2) angle of incidence, (3) optical constants of the sample at $\omega$ and $2\omega$ (may be complex-valued), (4) optical constants of the incident medium at $\omega$ and $2\omega$, (5) the crystallographic point group of the sample surface, (6) a vector function describing the azimuthal dependence of the extraordinary axis $\hat{\boldsymbol{c}}$ (applicable to uniaxial crystals). pySHRA was originally designed to model SHRA of single-crystal samples prepared by epitaxial growth of a thin film on a single-crystal substrate. For this use case, (7) the thickness of the thin film and (8) the optical constants of the substrate must also be supplied in order to correct the top surface reflection/transmission coefficients for internal reflections occurring at the film-substrate interface. During model setup, the user selects whether reflection/transmission coefficients are to be calculated assuming the system's linear optical properties are isotropic-isotropic, isotropic-uniaxial, or isotropic-uniaxial-uniaxial.  

A brief summary of the pySHRA workflow is as follows. Prior to running the model, the refractive indices of the system must be read in and converted to dielectric constants. The refractive indices of the incident medium (medium I) are retrieved from the *refractiveindex.info* database using the *refractiveindex* package. The refractive indices of the sample (medium II or medium II + III) are retrieved from a user-supplied text file or using the *refractiveindex* package, according to the user's choice. Dielectric constant arrays are constructed for the media at $\omega$ and $2\omega$. In the example, the code is structured to perform a loop over a range of $\omega$ values and corresponding $\epsilon(\omega)$. In the next step of the startup sequence, media I, II, III are initialized as class instances and assigned their respective point groups. Symbolic $\phi$-dependent $\boldsymbol{\chi}^{(2)}(-2\omega;\omega,\omega)$ and $\chi^{(3)}(-2\omega;\omega,\omega,0)$ tensors consistent with the assigned point groups are generated and assigned to these objects. *Fresnel* objects are also initialized for $\omega$ and $2\omega$, which contain functions for computing reflection/transmission coefficients. An *Evaluation* object is also initialized and assigned the media and *Fresnel* objects as attributes. This class contains functions for computing SH electric field amplitudes according to the Green function framework. After initialization, the wavelength sweep begins. The media objects are assigned their respective dielectric constants. Vectors $\hat{\boldsymbol{p}}$, $\hat{\boldsymbol{s}}$ are determined at $\omega$ and $2\omega$ for expressing the incident and reflected electric fields in medium I. According to the chosen method, the reflection/transmission coefficients for the I-II interface are computed, as well as the unit vectors for expressing the transmitted field in medium II. These results are packaged into various matrices defined in our publication, and are used to compute SH amplitudes for the canonical input-output combinations mentioned previously. Finally, the isotropic and anisotropic $cos(n\phi)$, $sin(n\phi)$ fourier components of the SH amplitudes are extracted. Outputs of the model and some useful intermediate results (e.g., reflection/transmission coefficients) are incorporated into four separate dictionaries: (1) SHRA fourier components for $\boldsymbol{\chi}^{(2)}(-2\omega;\omega,\omega)$, (2) SHRA fourier components for $\boldsymbol{\chi}^{(3)}(-2\omega;\omega,\omega,0)$, (3) various parameters related to the linear response at $\omega$, (4) various parameters related to the linear response at $2\omega$. These four dictionaries are saved to four separate pickle files ending in "X2_fourier", "X3_fourier", "fund_fresnel", "SH_fresnel". 

The core functionality of pySHRA is contained in a few separate files. Users are expected to mainly interact with *SHRAmodel.py*, which reads in and properly formats optical constant arrays for a system of interest, sets values for model parameters, evaluates the model, and saves results. *SHRAhelper.py* contains essential helper functions and classes for formatting optical constant arrays, calculating transmission/reflection coefficients of the interface, and building the dictionaries that get saved to the "fund_fresnel"/"SH_fresnel" pickle files. Note that, for uniaxial crystals, many of the quantities saved to these files will depend on $\phi$; thus, the dictionaries contain symbolic expressions that depend on *sympy* variable $\phi$. For isotropic-isotropic and isotropic-uniaxial systems, calculation of transmission/reflection coefficients is handled within *SHRAhelper.py*. For isotropic-uniaxial-uniaxial systems, the equations for these coefficients are massive, and are instead read in from two text files called  "fresnel_iso_uni_uni_p_in.txt" and "fresnel_iso_uni_uni_s_in.txt" which . They were generated by a Mathematica code that can also be found in the pySHRA repository. *susceptibility_tensors.py* is responsible for generating a symbolic $\boldsymbol{\chi}^{(2)}$ or $\boldsymbol{\chi}^{(3)}$ tensor appropriate to the user-specified point group. The symmetry operations associated with the point group are retrieved using the *pymatgen* package. These symmetry operations are applied, along with permutation symmetry in the 2nd and 3rd tensor indices, to determine the nonvanishing elements. The reduced tensor is then transformed to reflect azimuthal rotation about the lab z axis. Disclaimer: though in principle, all 32 point groups are supported, extensive testing was not done to confirm the code achieves the same canonical tensor representations given in, e.g., Robert W. Boyd's *Nonlinear Optics* text. Users should verify that their choice of surface coordinates (i.e., the crystallographic directions referred to by the tensor indices) is consistent with the tensor returned by this code. *SHRAevaluation.py* contains code for computing the SH electric field associated with each nonvanishing susceptibility element, for each of the four canonical input-output combinations (p-in/p-out, p-in/s-out, s-in/p-out, s-in/s-out). For this calculation, susceptibility elements are set equal to 1 one at a time while all others are set to zero. In effect, the computed quantity can be considered as an overall prefactor or Fresnel coefficient associated with that nonzero element; the field predicted from the interference of multiple nonzero elements is a linear combination comprised of these prefactors and their associated susceptibilities. The *SHRAevaluation.py* file also performs a Fourier decomposition on the SH fields/prefactors and builds the dictionaries which get saved to the "X2_fourier"/"X3_fourier" pickle files.

After a user has generated output files for their system of interest, the results can be inspected and put to use by parsing the dictionaries contained in the pickle files. The structure of these dictionaries is shown in two text files which can be found in the pySHRA repository: "fresnel_dict_structure.txt", "fourier_dict_structure.txt". In *SHRA_polar_plots.py*, we provide a code for plotting the azimuthal dependence of individual $\chi^{(2)}$ or $\chi^{(3)}$ elements (i.e., the azimuthal dependence of the associated Fresnel coefficients) which illustrates an example of how the "X2_fourier/X3_fourier" pickle files may be parsed. 
